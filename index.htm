<html>
<head>

<link rel="stylesheet" href="styles.css?1"/>

<title></title>
<script language="javascript">
let DisneyService=new function(){
this.dataSource="https://cd-static.bamgrid.com/dp-117731241344/home.json";
this.dataSource="test.json";
this.container="";
this.viewable=4;
this.prefill=2;
this.cursor=0;
this.user={
row:0,
col:0,
active:""
}



this.getData=(source,callback)=>{

fetch(source)
.then((response)=>response.json())
.then((data)=>{ console.log(data);callback(data)});



}



this.parse=(contents)=>{

var cdata=contents.data.StandardCollection;

return cdata;

}

this.installShelving=(content,holder)=>{
for (var x of content.containers){
console.log(x);
var sholder=this.renderBlock(holder,{id:"", url:"", class: "shelf", text: ""});

this.renderBlock(sholder,{id:"", url:"", class: "shelfTitle", text: x.set.text.title.full.set.default.content});
var shelf=this.renderBlock(sholder,{id:"", url:"", class: "shelfItems", text: ""});
this.renderBlock(shelf,{id:x.set.setId, url:"", class: "shelfSet", text: ""});
}
}

this.fillShelves=(content,holder)=>{
var x=this.cursor;
while(x<(this.cursor+this.viewable+this.prefill)){

if(!content.containers[x].set.items){break;};
for (var y of content.containers[x].set.items){
var url=this.grabImageUrl(y.image); 
var aimg=this.renderBlock(document.getElementById(content.containers[x].set.setId), {id:y.contentId,url: url,text: "test", class: "content"});
if (!this.user.active){
this.setActive(aimg);
}
}
++x;
}

return true;


}


this.setActive=(content)=>{
if (this.user.lastActive){
this.user.lastActive.classList.remove("active");
}
this.user.lastActive=this.user.active;
this.user.active=content;
this.user.active.classList.add("active");

}

//consider recusion for grabspecific data;

this.grabImageUrl=(content)=>{
for (var z in content){
var url=content[z];
for (var x in content[z]){
url=content[z][x];
for (var y in url){
console.log(url[y].default.url);
return url[y].default.url;
}
}
break;
}
}

this.renderBlock=(blockParent, contents)=>{
var block=this.scaffold(blockParent,contents.id);
block.className=contents.class;
if (contents.url!=""){
var i=new Image(160,90);
i.src=contents.url;
i.alt=contents.text;
block.appendChild(i);

}
else{
block.innerText=contents.text;
}
return block;

}

this.fill=(data)=>{
	var fillRef=document.getElementsByTagName("body");
	this.container=this.scaffold(fillRef[0],"container");
	var parsedata=this.parse(data);
	console.log(parsedata);
	this.installShelving(parsedata,this.container);
	this.fillShelves(parsedata,this.container);
	
    console.log(this.container);
};

this.scaffold=(parentContainer,id)=>{
	var fillChild=document.createElement("div");
	fillChild.id=id;	
	parentContainer.appendChild(fillChild);
    return fillChild;
};

this.nav=(e)=>{
console.log(e);

/*

switch(e.key){
case " ":
this.pageDown();
break;
}

*/

var dir=e.keyCode;
//32=space



/*39=right
40=down
37=left
38=up



-30
-8


7    -1  left
8     0
9      1  right
10      2
*/


e.bubbles=false;
return false;
}

this.move=(dir)=>{
console.log(dir % 2);
}

this.pageDown=()=>{



}


this.init=()=>{
   window.onkeyup=this.nav;
	this.getData(this.dataSource,this.fill);
	
	console.log(this.container);
};

window.onload=this.init;
}();


</script>
</head>
<body>





<script language="javascript">
//user code

// DisneyService.init(fillRef);

</script>

</body>
</html>